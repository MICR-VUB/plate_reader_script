---
title: "Data visualisation"
author: "Vincent Crabbe (adapted from Indra Bervoets & Amber Bernauw)"
date: "`r format(Sys.Date(), '%d/%m/%Y')`"
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding=encoding, knit_root_dir="..", output_dir="../Output")})
output: 
  html_document:
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(patchwork)
source("../helpers.R")
```



```{r}
current_dir <- getwd()
# print(current_dir)
output_dir <- file.path(current_dir, "Output")

load(file.path(output_dir, "01_import.RData"))
```


```{r, include=FALSE}
# Data manipulation and cleaning
corrected_data <- subtract_medium(data)
medium <- filter(corrected_data, strain == "medium")
no_medium <- filter(corrected_data, strain != "medium")
```

# Overview plots
## All data
```{r echo=FALSE, fig.height=10, fig.width=14}
p1 <- ggplot(corrected_data, aes(x = time, y = OD, color = fct_reorder2(strain, time, RFU))) +
  geom_point(cex = 0.7) +
  labs(color = "Inoculum")
p2 <- ggplot(corrected_data, aes(x = time, y = FL, color = fct_reorder2(strain, time, RFU))) +
  geom_point(cex = 0.7) +
  labs(color = "Inoculum")
p3 <- ggplot(corrected_data, aes(x = time, y = RFU, color = fct_reorder2(strain, time, RFU))) +
  geom_point(cex = 0.7) +
  labs(color = "Inoculum")

wrap_plots(p1, p2, p3, ncol = 2)
```

## Only medium

```{r echo=FALSE, fig.height=10, fig.width=14}
top_plots <- lapply(
  c("OD", "FL"),
  make_plot,
  data = medium,
  cat_var = "inducer_conc"
  )

# Check whether the mean OD and FL of the medium are elevated:
med <- medium |>
  group_by(time) |>
  summarise(
    OD_med_t = mean(OD, na.rm = TRUE),
    FL_med_t = mean(FL, na.rm = TRUE)
  ) |>
  ungroup()
plot_3 <- ggplot(med, aes(x = time, y = OD_med_t)) +
  geom_point(cex = 1) +
  labs(y = "Average OD")
plot_4 <- ggplot(med, aes(x = time, y = FL_med_t)) +
  geom_point(cex = 1) +
  labs(y = "Average FL")

wrap_plots(top_plots[[1]], top_plots[[2]], plot_3, plot_4)
```
4/16 medium wells are severely contaminated. Average medium OD and FL are elevated, so all ODc and FLc values will be affected. Analyse data with caution.

## Without medium

```{r echo=FALSE, fig.height=10, fig.width=14}
plots <- lapply(
  c("ODc", "FLc", "RFU"),
  make_plot,
  data = no_medium,
  cat_var = "inducer_conc"
  )
wrap_plots(plots, nrow = 2)
```

# Detailed plots
## 0 mM β-alanine

```{r echo=FALSE, fig.height=10, fig.width=14}
bs01_0 <- filter(no_medium, effector_conc == 0)

plots <- lapply(
  c("OD", "FL", "RFU"),
  make_plot,
  data = bs01_0,
  cat_var = "inducer_conc"
  )
wrap_plots(plots, nrow = 2)

plot_replicates_separately(bs01_0, num_replicates = 4, cat_var = "inducer_conc")
```

## 10 mM β-alanine

```{r echo=FALSE, fig.height=10, fig.width=14}
bs01_10 <- filter(no_medium, effector_conc == 10)

plots <- lapply(
  c("OD", "FL", "RFU"),
  make_plot,
  data = bs01_0,
  cat_var = "inducer_conc"
  )
wrap_plots(plots, nrow = 2)

plot_replicates_separately(
  bs01_10,
  num_replicates = 4,
  cat_var = "inducer_conc"
  )
```

